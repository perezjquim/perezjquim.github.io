sap.ui.define(["sap/ui/core/Component","../user_tracker/controller/util/Tracker","sap/ui/core/Fragment","sap/ui/core/BusyIndicator"],function(e,t,o,n){return e.extend("com.perezjquim.showcase.plugins.spotify.Component",{BUTTON_ID:"spotify-icon",BUTTON_TEXT:"Spotify",metadata:{manifest:"json"},init:function(){var e=this._getRenderer();e.then(function(e){this._renderButton(e)}.bind(this))},_getRenderer:function(){var e=this,t=new jQuery.Deferred,o;e._oShellContainer=jQuery.sap.getObject("sap.ushell.Container");if(!e._oShellContainer){t.reject("Illegal state: shell container not available; this component must be executed in a unified shell runtime context.")}else{o=e._oShellContainer.getRenderer();if(o){t.resolve(o)}else{e._onRendererCreated=function(e){o=e.getParameter("renderer");if(o){t.resolve(o)}else{t.reject("Illegal state: shell renderer not available after recieving 'rendererLoaded' event.")}};e._oShellContainer.attachRendererCreatedEvent(e._onRendererCreated)}}return t.promise()},_renderButton:function(e){e.addHeaderEndItem("sap.ushell.ui.shell.ShellHeadItem",{id:this.BUTTON_ID,text:this.BUTTON_TEXT,press:this._onPress.bind(this)},true,false)},_onPress:function(e){t.notify("PEREZJQUIM PAGE > PRESSED ON SPOTIFY!","");this._openPlaylist(e)},_openPlaylist:function(e){const t=e.getSource();setTimeout(function(){if(!this._oPlaylistPopover){n.show();o.load({name:"com.perezjquim.showcase.plugins.spotify.fragment.EmbedPopover",controller:this}).then(function(e){n.hide();this._mapModels(e);e.openBy(t);this._oPlaylistPopover=e}.bind(this))}else{if(this._oPlaylistPopover.isOpen()){this._oPlaylistPopover.close()}else{this._oPlaylistPopover.openBy(t)}}}.bind(this))},_mapModels:function(e){const t=this.oModels;for(var o in t){e.setModel(t[o],o)}},onBeforeOpenPopover:function(e){const t=this.getModel("misc");t.setProperty("/is_iframe_busy",true)},onAfterRenderingIframe:function(e){const t=this.getModel("misc");const o=$("#z_spotify_embed_popover_iframe");o.one("load",function(){t.setProperty("/is_iframe_busy",false)})},onClosePopover:function(e){const t=e.getSource();const o=t.getParent();const n=o.getParent();n.close()},onOpenPlaylist:function(e){const t=this.getModel("misc");const o=t.getProperty("/playlist_url");window.open(o)}})});